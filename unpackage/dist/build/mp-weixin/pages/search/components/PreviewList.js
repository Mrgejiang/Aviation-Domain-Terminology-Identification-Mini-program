"use strict";const e=require("../../../common/vendor.js");if(!Array){(e.resolveComponent("uni-load-more")+e.resolveComponent("unicloud-db"))()}Math||((()=>"../../../uni_modules/uni-load-more/components/uni-load-more/uni-load-more.js")+(()=>"../../../node-modules/@dcloudio/uni-components/lib/unicloud-db/unicloud-db.js"))();const a=e.defineComponent({__name:"PreviewList",props:{searchParams:{}},setup(a,{expose:o}){const n=a,t=e.er.database(),s=t.collection("opendb-news-categories").field("_id,name").getTemp(),r=[t.collection("opendb-news-articles").field("_id,poster,cnDetails.name,cnDetails.category_id,usDetails.name,usDetails.category_id,euDetails.name,euDetails.category_id").getTemp(),s],l=t.command,c=e.computed((()=>u()));e.ref({contentdown:"",contentrefresh:"",contentnomore:""});const i=(e,a,o)=>{console.log("结果",e,a,o)},d=e.ref(null);o({resetData:async()=>{await d.value.loadData({clear:!0},(()=>{})),console.log("重载数据")},getMore:async()=>{await d.value.loadMore(),console.log("加载更多")},loadData:async()=>{await d.value.loadData({clear:!0},(()=>{}))}});const u=()=>{let e=[];return["cn","us","eu"].forEach((a=>{if("all"===n.searchParams.country||n.searchParams.country===a){let o={name:""};"fuzzy"===n.searchParams.method?o.name=new RegExp(n.searchParams.content,"i"):o.name=n.searchParams.content,"all"!==n.searchParams.categoryId&&(o.category_id={_id:n.searchParams.categoryId}),"cn"===a?e.push({cnDetails:o}):"us"===a?e.push({usDetails:o}):e.push({euDetails:o})}})),console.log("搜索参数",n.searchParams,e),l.or(e)};return(a,o)=>({a:e.w((({data:a,loading:o,hasMore:n,error:t},s,r)=>e.e({a:t},t?{b:e.t(t.message)}:a?{d:e.f(a,((a,o,n)=>{var t,s,r;return{a:a.poster,b:e.t(a.cnDetails.name||a.usDetails.name||a.euDetails.name),c:e.t((null==(t=a.cnDetails.category_id[0])?void 0:t.name)||(null==(s=a.usDetails.category_id[0])?void 0:s.name)||(null==(r=a.euDetails.category_id[0])?void 0:r.name)||"未分类"),d:a._id,e:`/pages/details/details?id=${a._id}`}}))}:{},{c:a,e:"2ec7b1b4-1-"+r+",2ec7b1b4-0",f:e.p({status:o?"loading":n?"more":"noMore"}),g:r,h:s})),{name:"d",path:"a",vueId:"2ec7b1b4-0"}),b:e.sr(d,"2ec7b1b4-0",{k:"udb"}),c:e.o(i),d:e.p({loadtime:"auto",collection:r,where:c.value,"page-size":10})})}});wx.createComponent(a);
