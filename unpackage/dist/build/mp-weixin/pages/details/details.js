"use strict";const e=require("../../common/vendor.js"),l=require("../../uni_modules/uni-id-pages/common/store.js");if(!Array){e.resolveComponent("PageSkeleton")()}const o=e.defineComponent({__name:"details",setup(o){const a=e.er.database(),n=a.collection("opendb-news-favorite");a.collection("read-news-log");const t=l=>{e.index.showToast({title:"视频走丢了!",icon:"none"})},i=e.ref(),s=e.ref(!0),u=e.ref("");e.onLoad((async o=>{if(s.value=!0,console.log("详情_id",o.id),u.value=o.id,await(async()=>{const e=a.collection("opendb-news-categories").field("_id,name").getTemp(),l=await a.collection("opendb-news-articles",e).where('_id=="'+u.value+'"').get();i.value=l.result.data[0],console.log("获取词条详细数据",i.value),v()})(),e.index.setNavigationBarTitle({title:`词条: ${i.value.cnDetails.name||i.value.usDetails.name||i.value.euDetails.name}`}),l.store.hasLogin){const e=await n.where(`"article_id" == "${u.value}" && "user_id"==$env.uid`).get();e.result.data.length>0&&(d.value=!0,c=e.result.data[0]._id)}s.value=!1}));const d=e.ref(!1);let c="";const r=async()=>{if(!l.store.hasLogin)return e.index.showModal({content:"是否现在登录？",confirmColor:"#6cb8f3",success:l=>{l.confirm&&e.index.navigateTo({url:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd"})}});d.value?n.doc(c).remove().then((e=>{console.log("取消收藏",e),c="",d.value=!1})).catch((l=>{console.log(l),e.index.showToast({title:"出错了!",icon:"none"})})):n.add({article_id:u.value}).then((e=>{console.log("收藏",e),c=e.result.id,d.value=!0})).catch((l=>{console.log(l),e.index.showToast({title:"出错了!",icon:"none"})}))},v=()=>{let l={article_id:u.value,last_time:Date.now()},o=e.index.getStorageSync("readNewsLog")||[],a=-1;o.forEach((({article_id:e},o)=>{e==l.article_id&&(a=o)})),-1===a?o.push(l):o.splice(a,1,l),e.index.setStorageSync("readNewsLog",o),console.log("本地历史记录",o)};return(l,o)=>{var a,n,u,c,v,g,m;return e.e({a:s.value},s.value?{}:e.e({b:null==(a=i.value)?void 0:a.video,c:null==(n=i.value)?void 0:n.poster,d:null==(u=i.value)?void 0:u.cnDetails.name,e:e.o(t),f:d.value},d.value?{g:e.o(r)}:{h:e.o(r)},{i:e.f([null==(c=i.value)?void 0:c.cnDetails,null==(v=i.value)?void 0:v.usDetails,null==(g=i.value)?void 0:g.euDetails],((l,o,a)=>{var n,t;return e.e({a:e.t(0===o?"中":1===o?"美":"欧"),b:e.t(null==l?void 0:l.name),c:0===o},0===o?{d:e.t(null==(n=i.value)?void 0:n.cnDetails.en)}:{},{e:e.t(null==l?void 0:l.abbr),f:e.t((null==(t=l.category_id[0])?void 0:t.name)||"未分类"),g:e.t(null==l?void 0:l.define),h:e.t(null==l?void 0:l.source),i:e.t(null==l?void 0:l.expand),j:o})})),j:e.t(null==(m=i.value)?void 0:m.compareResult)}))}}}),a=e._export_sfc(o,[["__scopeId","data-v-41916d77"]]);wx.createPage(a);
