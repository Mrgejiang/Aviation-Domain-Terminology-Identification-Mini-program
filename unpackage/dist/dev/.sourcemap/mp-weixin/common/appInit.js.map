{"version":3,"file":"appInit.js","sources":["common/appInit.js"],"sourcesContent":["import uniStarterConfig from '@/uni-starter.config.js';\n//应用初始化页\n// #ifdef APP-PLUS\nimport checkUpdate from '@/uni_modules/uni-upgrade-center-app/utils/check-update';\nimport callCheckVersion from '@/uni_modules/uni-upgrade-center-app/utils/call-check-version';\n\n// 实现，路由拦截。当应用无访问摄像头/相册权限，引导跳到设置界面 https://ext.dcloud.net.cn/plugin?id=5095\nimport interceptorChooseImage from '@/uni_modules/json-interceptor-chooseImage/js_sdk/main.js';\ninterceptorChooseImage()\n\n// #endif\nconst db = uniCloud.database()\nexport default async function() {\n\tconst debug = uniStarterConfig.debug;\n\n\t// uniStarterConfig挂载到getApp().globalData.config\n\tsetTimeout(() => {\n\t\tgetApp({\n\t\t\tallowDefault: true\n\t\t}).globalData.config = uniStarterConfig;\n\t}, 1)\n\n\n\t// 初始化appVersion（仅app生效）\n\tinitAppVersion();\n\n\t//clientDB的错误提示\n\tfunction onDBError({\n\t\tcode, // 错误码详见https://uniapp.dcloud.net.cn/uniCloud/clientdb?id=returnvalue\n\t\tmessage\n\t}) {\n\t\tconsole.log('onDBError', {\n\t\t\tcode,\n\t\t\tmessage\n\t\t});\n\t\t// 处理错误\n\t\tconsole.error(code, message);\n\t}\n\t// 绑定clientDB错误事件\n\tdb.on('error', onDBError)\n\n\n\t//拦截云对象请求\n\tuniCloud.interceptObject({\n\t\tasync invoke({\n\t\t\tobjectName, // 云对象名称\n\t\t\tmethodName, // 云对象的方法名称\n\t\t\tparams // 参数列表\n\t\t}) {\n\t\t\t// console.log('interceptObject',{\n\t\t\t// \tobjectName, // 云对象名称\n\t\t\t// \tmethodName, // 云对象的方法名称\n\t\t\t// \tparams // 参数列表\n\t\t\t// });\n\t\t\tif(objectName == \"uni-id-co\" && (methodName.includes('loginBy') ||  ['login','registerUser'].includes(methodName) )){\n\t\t\t\tconsole.log('执行登录相关云对象');\n\t\t\t\tparams[0].inviteCode = await new Promise((callBack) => {\n\t\t\t\t\tuni.getClipboardData({\n\t\t\t\t\t\tsuccess: function(res) {\n\t\t\t\t\t\t\tconsole.log('剪切板内容：'+res.data);\n\t\t\t\t\t\t\tif (res.data.slice(0, 18) == 'uniInvitationCode:') {\n\t\t\t\t\t\t\t\tlet uniInvitationCode = res.data.slice(18, 38)\n\t\t\t\t\t\t\t\tconsole.log('当前用户是其他用户推荐下载的,推荐者的code是：' + uniInvitationCode);\n\t\t\t\t\t\t\t\t// uni.showModal({\n\t\t\t\t\t\t\t\t// \tcontent: '当前用户是其他用户推荐下载的,推荐者的code是：'+uniInvitationCode,\n\t\t\t\t\t\t\t\t// \tshowCancel: false\n\t\t\t\t\t\t\t\t// });\n\t\t\t\t\t\t\t\tcallBack(uniInvitationCode)\n\t\t\t\t\t\t\t\t//当前用户是其他用户推荐下载的。这里登记他的推荐者id 为当前用户的myInviteCode。判断如果是注册\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcallBack()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfail() {\n\t\t\t\t\t\t\tconsole.log('error--');\n\t\t\t\t\t\t\tcallBack()\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcomplete() {\n\t\t\t\t\t\t\t// #ifdef MP-WEIXIN\n\t\t\t\t\t\t\tuni.hideToast()\n\t\t\t\t\t\t\t// #endif\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t// console.log(params);\n\t\t\t}\n\t\t\t// console.log(params);\n\t\t},\n\t\tsuccess(e) {\n\t\t\tconsole.log(e);\n\t\t},\n\t\tcomplete() {\n\n\t\t},\n\t\tfail(e){\n\t\t\tconsole.error(e);\n\t\t\t// if (debug) {\n\t\t\t// \tuni.showModal({\n\t\t\t// \t\tcontent: JSON.stringify(e),\n\t\t\t// \t\tshowCancel: false\n\t\t\t// \t});\n\t\t\t// }else{\n\t\t\t// \tuni.showToast({\n\t\t\t// \t\ttitle: '系统错误请稍后再试',\n\t\t\t// \t\ticon:'error'\n\t\t\t// \t});\n\t\t\t// }\n\t\t}\n\t})\n\n\n\t// #ifdef APP-PLUS\n\t// 监听并提示设备网络状态变化\n\tuni.onNetworkStatusChange(res => {\n\t\tconsole.log(res.isConnected);\n\t\tconsole.log(res.networkType);\n\t\tif (res.networkType != 'none') {\n\t\t\tuni.showToast({\n\t\t\t\ttitle: '当前网络类型：' + res.networkType,\n\t\t\t\ticon: 'none',\n\t\t\t\tduration: 3000\n\t\t\t})\n\t\t} else {\n\t\t\tuni.showToast({\n\t\t\t\ttitle: '网络类型：' + res.networkType,\n\t\t\t\ticon: 'none',\n\t\t\t\tduration: 3000\n\t\t\t})\n\t\t}\n\t});\n\t// #endif\n\n}\n/**\n * // 初始化appVersion\n */\nfunction initAppVersion() {\n\t// #ifdef APP-PLUS\n\tlet appid = plus.runtime.appid;\n\tplus.runtime.getProperty(appid, (wgtInfo) => {\n\t\tlet appVersion = plus.runtime;\n\t\tlet currentVersion = appVersion.versionCode > wgtInfo.versionCode ? appVersion : wgtInfo;\n\t\tgetApp({\n\t\t\tallowDefault: true\n\t\t}).appVersion = {\n\t\t\t...currentVersion,\n\t\t\tappid,\n\t\t\thasNew: false\n\t\t}\n\t\t// 检查更新小红点\n\t\tcallCheckVersion().then(res => {\n\t\t\t// console.log('检查是否有可以更新的版本', res);\n\t\t\tif (res.result.code > 0) {\n\t\t\t\t// 有新版本\n\t\t\t\tgetApp({\n\t\t\t\t\tallowDefault: true\n\t\t\t\t}).appVersion.hasNew = true;\n\t\t\t\tconsole.log(checkUpdate());\n\t\t\t}\n\t\t})\n\t});\n\t// 检查更新\n\t// #endif\n}"],"names":["uniCloud","uniStarterConfig","uni"],"mappings":";;;AAWA,MAAM,KAAKA,cAAQ,GAAC,SAAU;AACf,eAAA,UAAiB;AACjBC,oBAAAA,OAAiB;AAG/B,aAAW,MAAM;AAChB,WAAO;AAAA,MACN,cAAc;AAAA,IACjB,CAAG,EAAE,WAAW,SAASA;EACvB,GAAE,CAAC;AAOJ,WAAS,UAAU;AAAA,IAClB;AAAA;AAAA,IACA;AAAA,EACF,GAAI;AACFC,kBAAAA,MAAA,MAAA,OAAA,2BAAY,aAAa;AAAA,MACxB;AAAA,MACA;AAAA,IACH,CAAG;AAEDA,kBAAc,MAAA,MAAA,SAAA,2BAAA,MAAM,OAAO;AAAA,EAC3B;AAED,KAAG,GAAG,SAAS,SAAS;AAIxBF,gBAAAA,GAAS,gBAAgB;AAAA,IACxB,MAAM,OAAO;AAAA,MACZ;AAAA;AAAA,MACA;AAAA;AAAA,MACA;AAAA;AAAA,IACH,GAAK;AAMF,UAAG,cAAc,gBAAgB,WAAW,SAAS,SAAS,KAAM,CAAC,SAAQ,cAAc,EAAE,SAAS,UAAU,IAAI;AACnHE,sBAAAA,MAAY,MAAA,OAAA,2BAAA,WAAW;AACvB,eAAO,CAAC,EAAE,aAAa,MAAM,IAAI,QAAQ,CAAC,aAAa;AACtDA,wBAAAA,MAAI,iBAAiB;AAAA,YACpB,SAAS,SAAS,KAAK;AACtBA,4BAAY,MAAA,MAAA,OAAA,2BAAA,WAAS,IAAI,IAAI;AAC7B,kBAAI,IAAI,KAAK,MAAM,GAAG,EAAE,KAAK,sBAAsB;AAClD,oBAAI,oBAAoB,IAAI,KAAK,MAAM,IAAI,EAAE;AAC7CA,8BAAY,MAAA,MAAA,OAAA,2BAAA,8BAA8B,iBAAiB;AAK3D,yBAAS,iBAAiB;AAAA,cAElC,OAAc;AACN,yBAAU;AAAA,cACV;AAAA,YACD;AAAA,YACD,OAAO;AACNA,4BAAAA,MAAY,MAAA,OAAA,2BAAA,SAAS;AACrB,uBAAU;AAAA,YACV;AAAA,YACD,WAAW;AAEVA,4BAAAA,MAAI,UAAW;AAAA,YAEf;AAAA,UACP,CAAM;AAAA,QACN,CAAK;AAAA,MAED;AAAA,IAED;AAAA,IACD,QAAQ,GAAG;AACVA,oBAAAA,MAAY,MAAA,OAAA,2BAAA,CAAC;AAAA,IACb;AAAA,IACD,WAAW;AAAA,IAEV;AAAA,IACD,KAAK,GAAE;AACNA,oBAAAA,MAAc,MAAA,SAAA,2BAAA,CAAC;AAAA,IAYf;AAAA,EACH,CAAE;AAwBF;;"}