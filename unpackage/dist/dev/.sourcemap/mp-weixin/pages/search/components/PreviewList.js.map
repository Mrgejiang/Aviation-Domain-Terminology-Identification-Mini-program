{"version":3,"file":"PreviewList.js","sources":["pages/search/components/PreviewList.vue","D:/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RTov5qGM6Z2iL-WIm-aWsOWfueiCsi9raXRlLW1hc3Rlci9wYWdlcy9zZWFyY2gvY29tcG9uZW50cy9QcmV2aWV3TGlzdC52dWU"],"sourcesContent":["<template>\n\t<view class=\"caption\">\n\t\t<text class=\"text\">搜索结果</text>\n\t</view>\n\t<view class=\"guess\">\n\t\t<unicloud-db @load=\"handleLoad\" loadtime=\"auto\" style=\"width: 100%;\" ref=\"udb\"\n\t\t\tv-slot:default=\"{data, loading, hasMore, error}\" :collection=\"collectionList\" :where=\"sWhere\"\n\t\t\t:page-size=\"10\">\n\t\t\t<view v-if=\"error\">{{error.message}}</view>\n\t\t\t<view v-else-if=\"data\">\n\t\t\t\t<navigator class=\"guess-item\" v-for=\"item in data\" :key=\"item._id\"\n\t\t\t\t\t:url=\"`/pages/details/details?id=${item._id}`\" open-type=\"navigate\">\n\t\t\t\t\t<image class=\"image\" mode=\"aspectFill\" :src=\"item.poster\"></image>\n\t\t\t\t\t<view class=\"name\"> {{ item.cnDetails.name||item.usDetails.name||item.euDetails.name }} </view>\n\t\t\t\t\t<view class=\"price\">\n\t\t\t\t\t\t<text>{{ item.cnDetails.category_id[0]?.name||item.usDetails.category_id[0]?.name||item.euDetails.category_id[0]?.name||'未分类' }}</text>\n\t\t\t\t\t</view>\n\t\t\t\t</navigator>\n\t\t\t</view>\n\t\t\t<uni-load-more :status=\"loading?'loading':(hasMore ? 'more' : 'noMore')\"></uni-load-more>\n\t\t</unicloud-db>\n\t</view>\n</template>\n\n<script lang=\"ts\" setup>\n\timport { computed, onMounted, ref, watch } from 'vue'\n\timport { onReady } from \"@dcloudio/uni-app\"\n\timport { SearchParams } from \"../../../types/search\"\n\n\t// 定义 props 接收数据\n\tconst props = defineProps<{\n\t\tsearchParams : SearchParams\n\t}>()\n\n\tconst db = uniCloud.database()\n\tconst category = db.collection('opendb-news-categories').field('_id,name').getTemp()\n\tconst acticle = db.collection('opendb-news-articles').field('_id,poster,cnDetails.name,cnDetails.category_id,usDetails.name,usDetails.category_id,euDetails.name,euDetails.category_id').getTemp()\n\tconst collectionList = [acticle, category]\n\t// const sField = '_id,poster,cnDetails.name,cnDetails.category_id,usDetails.name,usDetails.category_id,euDetails.name,euDetails.category_id'\n\n\tconst dbCmd = db.command\n\tconst sWhere = /* ref({}) */computed(() => {\n\t\treturn getWhere()\n\t})\n\n\t// onReady(() => {\n\t// \tuni.__f__('log','at pages/search/components/PreviewList.vue:47','onReady');\n\t// \tloadData()\n\t// \tuni.__f__('log','at pages/search/components/PreviewList.vue:49','readyed');\n\t// }) \n\n\tconst loadMore = ref({\n\t\tcontentdown: '',\n\t\tcontentrefresh: '',\n\t\tcontentnomore: ''\n\t})\n\n\tconst handleLoad = (data, ended, pagination) => {\n\t\t// `data` 当前查询结果\n\t\t// `ended` 是否有更多数据\n\t\t// `pagination` 分页信息 HBuilderX 3.1.5+ 支持\n\t\tuni.__f__('log','at pages/search/components/PreviewList.vue:62','结果', data, ended, pagination);\n\t}\n\n\t//通过组合式 API 获得该模板引用\n\tconst udb = ref(null)\n\n\t//重置数据\n\tconst resetData = async () => {\n\t\tawait udb.value.loadData({\n\t\t\tclear: true\n\t\t}, () => {\n\t\t})\n\t\tuni.__f__('log','at pages/search/components/PreviewList.vue:74',\"重载数据\");\n\t}\n\n\t//获取更多\n\tconst getMore = async () => {\n\t\tawait udb.value.loadMore()\n\t\tuni.__f__('log','at pages/search/components/PreviewList.vue:80',\"加载更多\");\n\t}\n\n\t//加载数据\n\tconst loadData = async () => {\n\t\t// sWhere.value = getWhere()\n\t\tawait udb.value.loadData({\n\t\t\tclear: true\n\t\t}, () => {\n\t\t})\n\t}\n\n\t// watch(() => { props.searchParams }, () => {\n\t// \tsWhere = getWhere()\n\t// \tresetData()\n\t// })\n\n\t//暴露给父组件方法\n\tdefineExpose({\n\t\tresetData,\n\t\tgetMore,\n\t\tloadData\n\t})\n\n\t//跳转详情\n\t// const handleItemClick = (id : string) => {\n\t// \tuni.navigateTo({\n\t// \t\turl: `/pages/details/details?id=${id}`\n\t// \t})\n\t// }\n\n\t// const isShow = ref(true)\n\n\t//监听id变化,重新获取数据\n\t// watch(\n\t// \t() => props.id,\n\t// \t() => {\n\t// \t\tisShow.value = false\n\t// \t\tsWhere = dbCmd.or([{\n\t// \t\t\tcnDetails: {\n\t// \t\t\t\tcategory_id: props.id\n\t// \t\t\t}\n\t// \t\t},\n\t// \t\t{\n\t// \t\t\tusDetails: {\n\t// \t\t\t\tcategory_id: props.id\n\t// \t\t\t}\n\t// \t\t},\n\t// \t\t{\n\t// \t\t\teuDetails: {\n\t// \t\t\t\tcategory_id: props.id\n\t// \t\t\t}\n\t// \t\t},\n\t// \t\t])\n\t// \t\tuni.__f__('log','at pages/search/components/PreviewList.vue:134','id变化', sWhere)\n\t// \t\tisShow.value = true\n\t// \t},\n\t// )\n\n\tconst getWhere = () => {\n\t\tlet res = [];\n\n\t\t//国家地区\n\t\t['cn', 'us', 'eu'].forEach((i) => {\n\t\t\tif (props.searchParams.country === 'all' || props.searchParams.country === i) {\n\t\t\t\tlet obj : { name : string | RegExp, category_id ?: { _id : string } } = { name: '' }\n\t\t\t\t//搜索方式 名称\n\t\t\t\tif (props.searchParams.method === 'fuzzy') {\n\t\t\t\t\tobj.name = new RegExp(props.searchParams.content, 'i')\n\t\t\t\t} else {\n\t\t\t\t\tobj.name = props.searchParams.content\n\t\t\t\t}\n\t\t\t\t//分类\n\t\t\t\tif (props.searchParams.categoryId !== 'all') {\n\t\t\t\t\tobj.category_id = { _id: props.searchParams.categoryId }\n\t\t\t\t}\n\t\t\t\tif (i === 'cn') {\n\t\t\t\t\tres.push({ cnDetails: obj })\n\t\t\t\t} else if (i === 'us') {\n\t\t\t\t\tres.push({ usDetails: obj })\n\t\t\t\t} else {\n\t\t\t\t\tres.push({ euDetails: obj })\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\n\t\tuni.__f__('log','at pages/search/components/PreviewList.vue:166','搜索参数', props.searchParams, res);\n\t\treturn dbCmd.or(res)\n\t\t//搜索方式 名称 国家\n\t\t// if (props.searchParams.method === 'fuzzy') {\n\t\t// \t//模糊搜索\n\t\t// \tlet sName = []\n\t\t// \tswitch (props.searchParams.country) {\n\t\t// \t\tcase 'all':\n\t\t// \t\t\tsName = [{\n\t\t// \t\t\t\tcnDetails: {\n\t\t// \t\t\t\t\tname: new RegExp(props.searchParams.content, 'i')\n\t\t// \t\t\t\t}\n\t\t// \t\t\t},\n\t\t// \t\t\t{\n\t\t// \t\t\t\tusDetails: {\n\t\t// \t\t\t\t\tname: new RegExp(props.searchParams.content, 'i')\n\t\t// \t\t\t\t}\n\t\t// \t\t\t},\n\t\t// \t\t\t{\n\t\t// \t\t\t\teuDetails: {\n\t\t// \t\t\t\t\tname: new RegExp(props.searchParams.content, 'i')\n\t\t// \t\t\t\t}\n\t\t// \t\t\t}]\n\t\t// \t\t\tbreak\n\t\t// \t\tcase 'cn':\n\t\t// \t\t\tsName = [\n\t\t// \t\t\t\t{\n\t\t// \t\t\t\t\tcnDetails: {\n\t\t// \t\t\t\t\t\tname: new RegExp(props.searchParams.content, 'i')\n\t\t// \t\t\t\t\t}\n\t\t// \t\t\t\t}\n\t\t// \t\t\t]\n\t\t// \t\t\tbreak\n\t\t// \t\tcase 'us':\n\t\t// \t\t\tsName = [\n\t\t// \t\t\t\t{\n\t\t// \t\t\t\t\tusDetails: {\n\t\t// \t\t\t\t\t\tname: new RegExp(props.searchParams.content, 'i')\n\t\t// \t\t\t\t\t}\n\t\t// \t\t\t\t}\n\t\t// \t\t\t]\n\t\t// \t\t\tbreak\n\t\t// \t\tcase 'eu':\n\t\t// \t\t\tsName = [\n\t\t// \t\t\t\t{\n\t\t// \t\t\t\t\teuDetails: {\n\t\t// \t\t\t\t\t\tname: new RegExp(props.searchParams.content, 'i')\n\t\t// \t\t\t\t\t}\n\t\t// \t\t\t\t}\n\t\t// \t\t\t]\n\t\t// \t\t\tbreak\n\t\t// \t}\n\t\t// \tres = dbCmd.or(sName)\n\t\t// } else {\n\t\t// \t//精确搜索\n\t\t// \tlet sName = []\n\t\t// \tswitch (props.searchParams.country) {\n\t\t// \t\tcase 'all':\n\t\t// \t\t\tsName = [{\n\t\t// \t\t\t\tcnDetails: {\n\t\t// \t\t\t\t\tname: props.searchParams.content\n\t\t// \t\t\t\t}\n\t\t// \t\t\t},\n\t\t// \t\t\t{\n\t\t// \t\t\t\tusDetails: {\n\t\t// \t\t\t\t\tname: props.searchParams.content\n\t\t// \t\t\t\t}\n\t\t// \t\t\t},\n\t\t// \t\t\t{\n\t\t// \t\t\t\teuDetails: {\n\t\t// \t\t\t\t\tname: props.searchParams.content\n\t\t// \t\t\t\t}\n\t\t// \t\t\t}]\n\t\t// \t\t\tbreak\n\t\t// \t\tcase 'cn':\n\t\t// \t\t\tsName = [\n\t\t// \t\t\t\t{\n\t\t// \t\t\t\t\tcnDetails: {\n\t\t// \t\t\t\t\t\tname: props.searchParams.content\n\t\t// \t\t\t\t\t}\n\t\t// \t\t\t\t}\n\t\t// \t\t\t]\n\t\t// \t\t\tbreak\n\t\t// \t\tcase 'us':\n\t\t// \t\t\tsName = [\n\t\t// \t\t\t\t{\n\t\t// \t\t\t\t\tusDetails: {\n\t\t// \t\t\t\t\t\tname: props.searchParams.content\n\t\t// \t\t\t\t\t}\n\t\t// \t\t\t\t}\n\t\t// \t\t\t]\n\t\t// \t\t\tbreak\n\t\t// \t\tcase 'eu':\n\t\t// \t\t\tsName = [\n\t\t// \t\t\t\t{\n\t\t// \t\t\t\t\teuDetails: {\n\t\t// \t\t\t\t\t\tname: props.searchParams.content\n\t\t// \t\t\t\t\t}\n\t\t// \t\t\t\t}\n\t\t// \t\t\t]\n\t\t// \t\t\tbreak\n\t\t// \t}\n\t\t// \tres = dbCmd.or(sName)\n\t\t// }\n\n\t\t// //分类\n\t\t// if (props.searchParams.categoryId !== 'all') {\n\t\t// \tlet category = dbCmd.or([{\n\t\t// \t\tcnDetails: {\n\t\t// \t\t\tcategory_id: {\n\t\t// \t\t\t\t_id: props.id\n\t\t// \t\t\t}\n\t\t// \t\t}\n\t\t// \t},\n\t\t// \t{\n\t\t// \t\tusDetails: {\n\t\t// \t\t\tcategory_id: {\n\t\t// \t\t\t\t_id: props.id\n\t\t// \t\t\t}\n\t\t// \t\t}\n\t\t// \t},\n\t\t// \t{\n\t\t// \t\teuDetails: {\n\t\t// \t\t\tcategory_id: {\n\t\t// \t\t\t\t_id: props.id\n\t\t// \t\t\t}\n\t\t// \t\t}\n\t\t// \t},\n\t\t// \t])\n\t\t// }\n\n\t\t// return methodNameCountry\n\t}\n</script>\n\n<style lang=\"scss\">\n\t:host {\n\t\tdisplay: block;\n\t}\n\n\t.caption {\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\tline-height: 1;\n\t\tpadding: 36rpx 0 40rpx;\n\t\tfont-size: 32rpx;\n\t\tcolor: #262626;\n\n\t\t.text {\n\t\t\tdisplay: flex;\n\t\t\tjustify-content: center;\n\t\t\talign-items: center;\n\t\t\tpadding: 0 28rpx 0 30rpx;\n\n\t\t\t&::before,\n\t\t\t&::after {\n\t\t\t\tcontent: '';\n\t\t\t\twidth: 20rpx;\n\t\t\t\theight: 20rpx;\n\t\t\t\tbackground-image: url(@/static/images/bubble.png);\n\t\t\t\tbackground-size: contain;\n\t\t\t\tmargin: 0 10rpx;\n\t\t\t}\n\t\t}\n\t}\n\n\t/* 推荐 */\n\t.guess {\n\t\tdisplay: flex;\n\t\tflex-wrap: wrap;\n\t\tjustify-content: space-between;\n\t\tpadding: 0 20rpx;\n\n\t\t.guess-item {\n\t\t\twidth: 100%;\n\t\t\tpadding: 24rpx 20rpx 20rpx;\n\t\t\tmargin-bottom: 20rpx;\n\t\t\tborder-radius: 10rpx;\n\t\t\toverflow: hidden;\n\t\t\tbackground-color: #fff;\n\t\t}\n\n\t\t.image {\n\t\t\twidth: 100%;\n\t\t\theight: 304rpx;\n\t\t}\n\n\t\t.name {\n\t\t\theight: 50rpx;\n\t\t\tmargin: 10rpx 0;\n\t\t\tfont-size: 40rpx;\n\t\t\tfont-weight: 700;\n\t\t\tcolor: #262626;\n\t\t\toverflow: hidden;\n\t\t\ttext-overflow: ellipsis;\n\t\t\tdisplay: -webkit-box;\n\t\t\t-webkit-line-clamp: 2;\n\t\t\t-webkit-box-orient: vertical;\n\t\t}\n\n\t\t.price {\n\t\t\tline-height: 1;\n\t\t\tcolor: #7b7979;\n\t\t\tfont-size: 26rpx;\n\t\t}\n\n\t\t.small {\n\t\t\tfont-size: 80%;\n\t\t}\n\t}\n\n\t// 加载提示文字\n\t.loading-text {\n\t\ttext-align: center;\n\t\tfont-size: 28rpx;\n\t\tcolor: #666;\n\t\tpadding: 20rpx 0;\n\t}\n</style>","import Component from 'E:/桌面/创新培育/kite-master/pages/search/components/PreviewList.vue'\nwx.createComponent(Component)"],"names":["uniCloud","computed","ref","uni","Component"],"mappings":";;;;;;;;;;;;;;;;;;AA8BC,UAAM,QAAQ;AAIR,UAAA,KAAKA,iBAAS;AACd,UAAA,WAAW,GAAG,WAAW,wBAAwB,EAAE,MAAM,UAAU,EAAE;AACrE,UAAA,UAAU,GAAG,WAAW,sBAAsB,EAAE,MAAM,2HAA2H,EAAE;AACnL,UAAA,iBAAiB,CAAC,SAAS,QAAQ;AAGzC,UAAM,QAAQ,GAAG;AACX,UAAA;AAAA;AAAA,MAAsBC,cAAAA,SAAS,MAAM;AAC1C,eAAO,SAAS;AAAA,MAAA,CAChB;AAAA;AAQgBC,sBAAI;AAAA,MACpB,aAAa;AAAA,MACb,gBAAgB;AAAA,MAChB,eAAe;AAAA,IAAA,CACf;AAED,UAAM,aAAa,CAAC,MAAM,OAAO,eAAe;AAI/CC,0BAAI,MAAM,OAAM,iDAAgD,MAAM,MAAM,OAAO,UAAU;AAAA,IAAA;AAIxF,UAAA,MAAMD,kBAAI,IAAI;AAGpB,UAAM,YAAY,YAAY;AACvB,YAAA,IAAI,MAAM,SAAS;AAAA,QACxB,OAAO;AAAA,MAAA,GACL,MAAM;AAAA,MAAA,CACR;AACGC,oBAAAA,MAAA,MAAM,OAAM,iDAAgD,MAAM;AAAA,IAAA;AAIvE,UAAM,UAAU,YAAY;AACrB,YAAA,IAAI,MAAM;AACZA,oBAAAA,MAAA,MAAM,OAAM,iDAAgD,MAAM;AAAA,IAAA;AAIvE,UAAM,WAAW,YAAY;AAEtB,YAAA,IAAI,MAAM,SAAS;AAAA,QACxB,OAAO;AAAA,MAAA,GACL,MAAM;AAAA,MAAA,CACR;AAAA,IAAA;AASW,aAAA;AAAA,MACZ;AAAA,MACA;AAAA,MACA;AAAA,IAAA,CACA;AAqCD,UAAM,WAAW,MAAM;AACtB,UAAI,MAAM,CAAA;AAGV,OAAC,MAAM,MAAM,IAAI,EAAE,QAAQ,CAAC,MAAM;AACjC,YAAI,MAAM,aAAa,YAAY,SAAS,MAAM,aAAa,YAAY,GAAG;AACzE,cAAA,MAAoE,EAAE,MAAM;AAE5E,cAAA,MAAM,aAAa,WAAW,SAAS;AAC1C,gBAAI,OAAO,IAAI,OAAO,MAAM,aAAa,SAAS,GAAG;AAAA,UAAA,OAC/C;AACF,gBAAA,OAAO,MAAM,aAAa;AAAA,UAC/B;AAEI,cAAA,MAAM,aAAa,eAAe,OAAO;AAC5C,gBAAI,cAAc,EAAE,KAAK,MAAM,aAAa;UAC7C;AACA,cAAI,MAAM,MAAM;AACf,gBAAI,KAAK,EAAE,WAAW,IAAK,CAAA;AAAA,UAAA,WACjB,MAAM,MAAM;AACtB,gBAAI,KAAK,EAAE,WAAW,IAAK,CAAA;AAAA,UAAA,OACrB;AACN,gBAAI,KAAK,EAAE,WAAW,IAAK,CAAA;AAAA,UAC5B;AAAA,QACD;AAAA,MAAA,CACA;AAEDA,0BAAI,MAAM,OAAM,kDAAiD,QAAQ,MAAM,cAAc,GAAG;AACzF,aAAA,MAAM,GAAG,GAAG;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrKrB,GAAG,gBAAgBC,SAAS;"}