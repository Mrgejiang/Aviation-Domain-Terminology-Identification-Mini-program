{"version":3,"file":"search.js","sources":["pages/search/search.vue","D:/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2VhcmNoL3NlYXJjaC52dWU"],"sourcesContent":["<template>\n\t<!-- 搜索框 -->\n\t<view class=\"search\">\n\t\t<uni-easyinput :styles=\"styles\" trim=\"both\" prefixIcon=\"search\" :clearable=\"true\" v-model=\"searchParams.content\"\n\t\t\ttype=\"text\" placeholder=\"搜索术语\" confirmType=\"search\" @iconClick=\"onSearch\" @confirm=\"onSearch\" />\n\t</view>\n\t<!-- 高级搜索 -->\n\t<view>\n\t\t<!-- v-model=\"isOpen\" accordion=\"true\" -->\n\t\t<uni-collapse v-model=\"isOpen\" accordion=\"true\">\n\t\t\t<uni-collapse-item ref=\"uci\" name=\"key1\" title=\"高级搜索\">\n\t\t\t\t<view class=\"paramsItem\">\n\t\t\t\t\t<view style=\"font-size: large; margin-bottom: 5px\">搜索方式</view>\n\t\t\t\t\t<uni-data-checkbox v-model=\"searchParams.method\" :localdata=\"[\n              { text: '模糊搜索', value: 'fuzzy' },\n              { text: '精确搜索', value: 'exact' },\n            ]\" mode=\"tag\" />\n\t\t\t\t</view>\n\t\t\t\t<!-- <view class=\"paramsItem\">\n\t\t\t\t\t<view style=\"font-size: large; margin-bottom: 5px\">语言</view>\n\t\t\t\t\t<uni-data-checkbox v-model=\"searchParams.language\" :localdata=\"[\n              { text: '中文', value: 'zh' },\n              { text: '英文', value: 'en' },\n            ]\" mode=\"tag\" />\n\t\t\t\t</view> -->\n\t\t\t\t<view class=\"paramsItem\">\n\t\t\t\t\t<view style=\"font-size: large; margin-bottom: 5px\">国家地区</view>\n\t\t\t\t\t<uni-data-checkbox v-model=\"searchParams.country\" :localdata=\"[\n\t\t\t\t{ text: '全部', value: 'all' },\n              { text: '中国', value: 'cn' },\n              { text: '美国', value: 'us' },\n              { text: '欧盟', value: 'eu' },\n            ]\" mode=\"tag\" />\n\t\t\t\t</view>\n\t\t\t\t<scroll-view style=\"max-height: 200px\" enable-flex scroll-y class=\"paramsItem\">\n\t\t\t\t\t<view style=\"font-size: large; margin-bottom: 5px\">分类</view>\n\t\t\t\t\t<uni-data-checkbox v-model=\"searchParams.categoryId\" :localdata=\"categoryList\" mode=\"tag\" />\n\t\t\t\t</scroll-view>\n\t\t\t</uni-collapse-item>\n\n\t\t\t<!-- <uni-collapse-item name=\"key2\" style=\"height: 1px;\" v-show=\"false\"></uni-collapse-item> -->\n\t\t</uni-collapse>\n\t</view>\n\t<!-- 搜索结果 -->\n\t<!-- 滚动容器：触底加载 -->\n\t<PageSkeleton v-if=\"isLoading\" />\n\t<scroll-view v-else enable-back-to-top refresher-enabled class=\"scroll-view\" scroll-y\n\t\t@scrolltolower=\"onScrolltolower\" @refresherrefresh=\"onRefresherrefresh\" :refresher-triggered=\"isLriggered\">\n\t\t<!-- <PageSkeleton v-if=\"isLoading\" /> -->\n\t\t<PreviewList ref=\"PreviewRef\" :searchParams=\"params\" />\n\t</scroll-view>\n</template>\n\n<script setup lang=\"ts\">\n\timport { onMounted, ref } from 'vue';\n\timport { onLoad, onReady } from '@dcloudio/uni-app'\n\timport { CategoryItem } from \"../../types/category\"\n\timport { SearchParams } from \"../../types/search\"\n\timport PreviewList from './components/PreviewList.vue';\n\n\tconst PreviewRef = ref(null)\n\tconst uci = ref(null)\n\t// PreviewList udb传递params\n\tconst params = ref({} as SearchParams)\n\n\t//触底加载\n\tconst onScrolltolower = () => {\n\t\tPreviewRef.value.getMore()\n\t}\n\n\tonLoad((op) => {\n\t\t//上一页传参\n\t\tisLoading.value = true\n\t\tsearchParams.value.content = op.content\n\t\tparams.value = searchParams.value\n\t\tsetTimeout(() => {\n\t\t\tisLoading.value = false\n\t\t}, 1000)\n\t})\n\n\t// onReady(() => {\n\t// \t// PreviewRef.value.resetData()\n\t// })\n\t// onMounted(() => {\n\t// \tPreviewRef.value.loadData()\n\t// })\n\n\t//搜索参数\n\tconst searchParams = ref<SearchParams>({\n\t\tcontent: '',\n\t\tmethod: 'fuzzy',\n\t\tcountry: 'all',\n\t\tcategoryId: 'all',\n\t})\n\n\t//分类\n\ttype PerCategory = {\n\t\ttext : string\n\t\tvalue : string\n\t}\n\tconst categoryList = ref<PerCategory[]>(\n\t\t[{ text: '全部', value: 'all' }].concat(uni.getStorageSync('categoryList')._value.map((item : CategoryItem) => {\n\t\t\treturn {\n\t\t\t\ttext: item.name,\n\t\t\t\tvalue: item._id,\n\t\t\t}\n\t\t})))\n\n\t//自定义下拉刷新状态\n\tconst isLriggered = ref(false)\n\t// 自定义下拉刷新被触发\n\tconst onRefresherrefresh = async () => {\n\t\t//开始动画\n\t\tisLriggered.value = true\n\t\t//重置预览列表数据\n\t\tawait PreviewRef.value?.resetData()\n\t\t//结束动画\n\t\tisLriggered.value = false\n\t}\n\n\tconst isOpen = ref('key2')\n\tconst isLoading = ref(false)\n\n\t//搜索\n\tconst onSearch = async () => {\n\t\tif (searchParams.value.content === '') {\n\t\t\treturn uni.showToast({\n\t\t\t\ttitle: '请输入搜索内容',\n\t\t\t\ticon: 'none',\n\t\t\t})\n\t\t}\n\t\tisLoading.value = true\n\n\t\t// //先重置预览列表数据\n\t\t// PreviewRef.value?.resetData()\n\t\t// //todo 重新请求-网络请求需要await\n\t\t// searchParam.value = searchParams.value.categoryId!\n\t\t// await PreviewRef.value?.getMore()\n\n\t\tparams.value = searchParams.value\n\t\t// PreviewRef.value.loadData()\n\n\t\tsetTimeout(() => { isLoading.value = false }, 1000)\n\n\t\tif (isOpen.value === 'key1') {\n\t\t\t// 搜索时关闭高级搜索选项卡\n\t\t\t// uni.__f__('log','at pages/search/search.vue:147',isOpen.value)\n\t\t\t// isOpen.value = 'key2'\n\t\t\tuci.value.onClick(false)\n\t\t\t// uni.__f__('log','at pages/search/search.vue:150',isOpen.value)\n\t\t}\n\t}\n\n\tconst styles = {\n\t\tcolor: '#333',\n\t\tborderColor: '#111',\n\t\tbackgroundColor: 'rgba(255, 255, 255, 0.5)',\n\t\tdisableColor: '#f7f6f6',\n\t}\n</script>\n\n\n<style lang=\"scss\">\n\tpage {\n\t\tbackground-color: #f7f7f7;\n\t\theight: 100%;\n\t\toverflow: hidden;\n\t}\n\n\t.search {\n\t\tpadding: 0 30rpx 20rpx;\n\t\tbackground-color: #f9f6f6;\n\t}\n\n\t.params {\n\t\tpadding: 0 30rpx;\n\t\tbackground-color: #f9f6f6;\n\t}\n\n\t.paramsItem {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tpadding: 10px;\n\t\tborder: 1px solid #ddd;\n\t\tborder-radius: 5px;\n\t\tbackground-color: #fff;\n\t\tmargin-bottom: 10px;\n\t}\n\n\t.scroll-view {\n\t\tflex: 1;\n\t\toverflow: hidden;\n\t\tpadding-bottom: 100px;\n\t}\n</style>","import MiniProgramPage from 'E:/桌面/创新培育/kite-master/pages/search/search.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onLoad","uni","MiniProgramPage"],"mappings":";;;;;;;;;;;;;;;;;AA0DC,MAAA,cAAwB,MAAA;;;;AAElB,UAAA,aAAaA,kBAAI,IAAI;AACrB,UAAA,MAAMA,kBAAI,IAAI;AAEd,UAAA,SAASA,kBAAI,CAAA,CAAkB;AAGrC,UAAM,kBAAkB,MAAM;AAC7B,iBAAW,MAAM;IAAQ;AAG1BC,kBAAA,OAAO,CAAC,OAAO;AAEd,gBAAU,QAAQ;AACL,mBAAA,MAAM,UAAU,GAAG;AAChC,aAAO,QAAQ,aAAa;AAC5B,iBAAW,MAAM;AAChB,kBAAU,QAAQ;AAAA,SAChB,GAAI;AAAA,IAAA,CACP;AAUD,UAAM,eAAeD,cAAAA,IAAkB;AAAA,MACtC,SAAS;AAAA,MACT,QAAQ;AAAA,MACR,SAAS;AAAA,MACT,YAAY;AAAA,IAAA,CACZ;AAOD,UAAM,eAAeA,cAAA;AAAA,MACpB,CAAC,EAAE,MAAM,MAAM,OAAO,MAAO,CAAA,EAAE,OAAOE,cAAAA,MAAI,eAAe,cAAc,EAAE,OAAO,IAAI,CAAC,SAAwB;AACrG,eAAA;AAAA,UACN,MAAM,KAAK;AAAA,UACX,OAAO,KAAK;AAAA,QAAA;AAAA,MACb,CACA,CAAC;AAAA,IAAA;AAGG,UAAA,cAAcF,kBAAI,KAAK;AAE7B,UAAM,qBAAqB,YAAY;;AAEtC,kBAAY,QAAQ;AAEd,cAAA,gBAAW,UAAX,mBAAkB;AAExB,kBAAY,QAAQ;AAAA,IAAA;AAGf,UAAA,SAASA,kBAAI,MAAM;AACnB,UAAA,YAAYA,kBAAI,KAAK;AAG3B,UAAM,WAAW,YAAY;AACxB,UAAA,aAAa,MAAM,YAAY,IAAI;AACtC,eAAOE,cAAAA,MAAI,UAAU;AAAA,UACpB,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACN;AAAA,MACF;AACA,gBAAU,QAAQ;AAQlB,aAAO,QAAQ,aAAa;AAG5B,iBAAW,MAAM;AAAE,kBAAU,QAAQ;AAAA,SAAS,GAAI;AAE9C,UAAA,OAAO,UAAU,QAAQ;AAIxB,YAAA,MAAM,QAAQ,KAAK;AAAA,MAExB;AAAA,IAAA;AAGD,UAAM,SAAS;AAAA,MACd,OAAO;AAAA,MACP,aAAa;AAAA,MACb,iBAAiB;AAAA,MACjB,cAAc;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC5JhB,GAAG,WAAWC,SAAe;"}