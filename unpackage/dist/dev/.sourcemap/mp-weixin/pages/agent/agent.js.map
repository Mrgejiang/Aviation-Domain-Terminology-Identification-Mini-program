{"version":3,"file":"agent.js","sources":["pages/agent/agent.vue","D:/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYWdlbnQvYWdlbnQudnVl"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<!-- 顶部机器人信息 -->\n\t\t<view class=\"header\">\n\t\t\t<image class=\"header-avatar\" :src=\"botInfo.icon_url\" mode=\"aspectFill\" />\n\t\t\t<view class=\"header-info\">\n\t\t\t\t<text class=\"bot-name\">{{ botInfo.name }}</text>\n\t\t\t\t<text class=\"bot-desc\">{{ botInfo.description }}</text>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<!-- 消息列表 -->\n\t\t<scroll-view \n\t\t\tclass=\"message-list\" \n\t\t\tscroll-y=\"true\" \n\t\t\t:scroll-into-view=\"lastMsgId\"\n\t\t\t:style=\"{ paddingBottom: '180rpx' }\"\n\t\t>\n\t\t\t<!-- 消息项 -->\n\t\t\t<view \n\t\t\t\tv-for=\"(msg, index) in messages\" \n\t\t\t\t:key=\"index\"\n\t\t\t\t:id=\"'msg' + index\"\n\t\t\t\t:class=\"['message-item', msg.type]\"\n\t\t\t>\n\t\t\t\t<image \n\t\t\t\t\tv-if=\"msg.type === 'ai'\"\n\t\t\t\t\tclass=\"avatar\"\n\t\t\t\t\t:src=\"botInfo.icon_url\" \n\t\t\t\t\tmode=\"aspectFill\"\n\t\t\t\t/>\n\t\t\t\t<view class=\"message-content\">\n\t\t\t\t\t<text v-if=\"msg.type === 'ai'\" class=\"bot-name\">{{ botInfo.name }}</text>\n\t\t\t\t\t<view class=\"message-bubble\">\n\t\t\t\t\t\t<text>{{ msg.content }}</text>\n\t\t\t\t\t\t<view class=\"message-footer\">\n\t\t\t\t\t\t\t<text class=\"time\">{{ msg.time }}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<image \n\t\t\t\t\tv-if=\"msg.type === 'user'\"\n\t\t\t\t\tclass=\"avatar\"\n\t\t\t\t\tsrc=\"/static/images/user-avatar.png\"\n\t\t\t\t\tmode=\"aspectFill\"\n\t\t\t\t/>\n\t\t\t</view>\n\t\t\t<!-- 预设问题 -->\n\t\t\t<view v-if=\"showSuggested\" class=\"suggested-questions\">\n\t\t\t\t<view \n\t\t\t\t\tv-for=\"(question, qIndex) in botInfo.suggestedQuestions\"\n\t\t\t\t\t:key=\"'q'+qIndex\"\n\t\t\t\t\tclass=\"question-tag\"\n\t\t\t\t\t@click=\"sendSuggested(question)\"\n\t\t\t\t>\n\t\t\t\t\t{{ question }}\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</scroll-view>\n\n\t\t<!-- 输入区域 - 修改为固定定位 -->\n\t\t<view class=\"input-wrapper\">\n\t\t\t<view class=\"input-area\">\n\t\t\t\t<input \n\t\t\t\t\tclass=\"input\" \n\t\t\t\t\tv-model=\"inputText\" \n\t\t\t\t\t:placeholder=\"inputPlaceholder\"\n\t\t\t\t\t@confirm=\"sendMessage\"\n\t\t\t\t/>\n\t\t\t\t<button class=\"send-btn\" @tap=\"sendMessage\" :disabled=\"isLoading\">\n\t\t\t\t\t{{ isLoading ? '思考中...' : '发送' }}\n\t\t\t\t</button>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tmessages: [],\n\t\t\t\tinputText: '',\n\t\t\t\tlastMsgId: '',\n\t\t\t\tbotInfo: {\n\t\t\t\t\tname: '',\n\t\t\t\t\ticon_url: '',\n\t\t\t\t\tdescription: '',\n\t\t\t\t\tsuggestedQuestions: []\n\t\t\t\t},\n\t\t\t\tinputPlaceholder: '请输入您的问题',\n\t\t\t\tisLoading: false,\n\t\t\t\tshowSuggested: true,\n\t\t\t\tconversationId: null\n\t\t\t}\n\t\t},\n\t\tcreated() {\n\t\t\tthis.initBotInfo()\n\t\t},\n\t\tmethods: {\n\t\t\tasync initBotInfo() {\n\t\t\t\ttry {\n\t\t\t\t\tconst res = await uni.request({\n\t\t\t\t\t\turl: 'https://api.coze.cn/v1/bot/get_online_info?bot_id=7461239179847172122',\n\t\t\t\t\t\tmethod: 'GET',\n\t\t\t\t\t\theader: {\n\t\t\t\t\t\t\t'Authorization': 'Bearer pat_6yySAkMrimmjkwJMfE8lfuUtJzJnwSwjYj34ACUZMIK21fFuWad3a91NvYuDl77s',\n\t\t\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tif(res.data.code === 0) {\n\t\t\t\t\t\tconst data = res.data.data\n\t\t\t\t\t\tthis.botInfo = {\n\t\t\t\t\t\t\tname: data.name,\n\t\t\t\t\t\t\ticon_url: data.icon_url,\n\t\t\t\t\t\t\tdescription: data.description,\n\t\t\t\t\t\t\tsuggestedQuestions: data.onboarding_info.suggested_questions\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tthis.messages.push({\n\t\t\t\t\t\t\ttype: 'ai',\n\t\t\t\t\t\t\tcontent: data.onboarding_info.prologue,\n\t\t\t\t\t\t\ttime: this.getCurrentTime()\n\t\t\t\t\t\t})\n\t\t\t\t\t\t\n\t\t\t\t\t\tconst promptMatch = data.prompt_info.prompt.match(/请输入(.*?)\\n/)\n\t\t\t\t\t\tthis.inputPlaceholder = promptMatch ? promptMatch[1] : '请输入您的问题'\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error('初始化失败:', e)\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tasync getAIResponse(question) {\n\t\t\t\ttry {\n\t\t\t\t\tconst res = await uni.request({\n\t\t\t\t\t\turl: 'https://api.coze.cn/open_api/v2/chat',\n\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\theader: {\n\t\t\t\t\t\t\t'Authorization': 'Bearer pat_6yySAkMrimmjkwJMfE8lfuUtJzJnwSwjYj34ACUZMIK21fFuWad3a91NvYuDl77s',\n\t\t\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tbot_id: '7461239179847172122',\n\t\t\t\t\t\t\tuser: 'uni-app-user',\n\t\t\t\t\t\t\tquery: question,\n\t\t\t\t\t\t\tstream: false\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tconst response = res.data;\n\t\t\t\t\tconsole.log('API返回数据:', response);\n\n\t\t\t\t\tif (response.code !== 0) {\n\t\t\t\t\t\tthrow new Error(response.msg || 'API返回错误');\n\t\t\t\t\t}\n\n\t\t\t\t\t// 在messages数组中查找type为'answer'的消息\n\t\t\t\t\tconst answerMessage = response.messages.find(msg => msg.type === 'answer');\n\t\t\t\t\tif (!answerMessage) {\n\t\t\t\t\t\tthrow new Error('未找到回答内容');\n\t\t\t\t\t}\n\n\t\t\t\t\t// 获取推荐问题\n\t\t\t\t\tconst followUpQuestions = response.messages\n\t\t\t\t\t\t.filter(msg => msg.type === 'follow_up')\n\t\t\t\t\t\t.map(msg => msg.content);\n\t\t\t\t\t\n\t\t\t\t\t// 如果有推荐问题，更新到botInfo中\n\t\t\t\t\tif (followUpQuestions.length > 0) {\n\t\t\t\t\t\tthis.botInfo.suggestedQuestions = followUpQuestions;\n\t\t\t\t\t\tthis.showSuggested = true;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcontent: answerMessage.content\n\t\t\t\t\t};\n\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('API请求失败:', error);\n\t\t\t\t\tthrow new Error(`请求失败：${error.message}`);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tasync sendMessage() {\n\t\t\t\tif (!this.inputText.trim() || this.isLoading) return\n\t\t\t\t\n\t\t\t\tthis.showSuggested = false\n\t\t\t\tconst userMsg = {\n\t\t\t\t\ttype: 'user',\n\t\t\t\t\tcontent: this.inputText,\n\t\t\t\t\ttime: this.getCurrentTime()\n\t\t\t\t}\n\t\t\t\tthis.messages.push(userMsg)\n\t\t\t\t\n\t\t\t\t// 创建AI回复消息占位\n\t\t\t\tconst aiMsg = {\n\t\t\t\t\ttype: 'ai',\n\t\t\t\t\tcontent: '',\n\t\t\t\t\ttime: this.getCurrentTime()\n\t\t\t\t}\n\t\t\t\tthis.messages.push(aiMsg)\n\t\t\t\t\n\t\t\t\tconst question = this.inputText\n\t\t\t\tthis.inputText = ''\n\t\t\t\tthis.isLoading = true\n\t\t\t\t\n\t\t\t\ttry {\n\t\t\t\t\tconst res = await this.getAIResponse(question)\n\t\t\t\t\t// 更新最后一条AI消息\n\t\t\t\t\taiMsg.content = res.content\n\t\t\t\t} catch (e) {\n\t\t\t\t\taiMsg.content = `请求失败：${e.message || '网络异常，请稍后重试'}`\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis.isLoading = false\n\t\t\t\tthis.scrollToBottom()\n\t\t\t},\n\n\t\t\tsendSuggested(question) {\n\t\t\t\tthis.inputText = question\n\t\t\t\tthis.sendMessage()\n\t\t\t},\n\n\t\t\tgetCurrentTime() {\n\t\t\t\tconst date = new Date()\n\t\t\t\treturn `${date.getHours()}:${date.getMinutes().toString().padStart(2, '0')}`\n\t\t\t},\n\n\t\t\tscrollToBottom() {\n\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\tthis.lastMsgId = 'msg' + (this.messages.length - 1)\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style>\r\n\tpage {\r\n\t\theight: 100%;\r\n\t\toverflow: hidden;\r\n\t}\n.container {\n\theight: 100vh;\n\tdisplay: flex;\n\tflex-direction: column;\n\tbackground-color: #f8f9fa;\n}\n\n.header {\n\tdisplay: flex;\n\talign-items: center;\n\tpadding: 1rpx 0rpx;\n\tbackground: white;\n\tborder-bottom: 1rpx solid #eee;\n}\n\n.header-avatar {\n\twidth: 100rpx;\n\theight: 100rpx;\n\tborder-radius: 16rpx;\n\tmargin-right: 20rpx;\n}\n\n.header-info {\n\tflex: 1;\n}\n\n.bot-name {\n\tfont-size: 34rpx;\n\tfont-weight: 500;\n}\n\n.bot-desc {\n\tfont-size: 24rpx;\n\tcolor: #666;\n\tdisplay: block;\n}\n\n.message-list {\n\tflex: 1;\n\tpadding: 20rpx 30rpx;\n\tbox-sizing: border-box;\n}\n\n.suggested-questions {\n\tmargin: 20rpx 0;\n}\n\n.question-tag {\n\tdisplay: block;\n\tpadding: 20rpx 30rpx;\n\tbackground: #e8f4ff;\n\tborder-radius: 16rpx;\n\tmargin-bottom: 20rpx;\n\tfont-size: 26rpx;\n\tcolor: #1890ff;\n}\n\n.message-item {\n\tdisplay: flex;\n\tmargin: 40rpx 0;\n}\n\n.message-item.user {\n\tflex-direction: row-reverse;\n}\n\n.message-content {\n\tflex: 1;\n\tmax-width: 75%;\n}\n\n.message-item.user .message-content {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: flex-end;\n}\n\n.message-bubble {\n\tpadding: 20rpx 30rpx;\n\tborder-radius: 12rpx;\n\tbackground: white;\n\tbox-shadow: 0 4rpx 12rpx rgba(0,0,0,0.05);\n}\n\n.message-item.user .message-bubble {\n\tbackground: #1890ff;\n\tcolor: white;\n}\n\n.message-item.user .time {\n\tcolor: rgba(255,255,255,0.8);\n}\n\n.avatar {\n\twidth: 80rpx;\n\theight: 80rpx;\n\tborder-radius: 8rpx;\n\tmargin: 0 20rpx;\n}\n\n.message-footer {\n\tmargin-top: 15rpx;\n\tpadding-top: 10rpx;\n\tborder-top: 1rpx solid rgba(255,255,255,0.2);\n}\n\n.time {\n\tfont-size: 24rpx;\n\tcolor: rgba(255,255,255,0.8);\n}\n\n.input-wrapper {\n\tposition: fixed;\n\tleft: 0;\n\tright: 0;\n\tbottom: 100rpx;\n\tz-index: 100;\n}\n\n.input-area {\n\tdisplay: flex;\n\talign-items: center;\n\tpadding: 20rpx 30rpx;\n\tbackground: white;\n\tbox-shadow: 0 -4rpx 16rpx rgba(0,0,0,0.1);\r\n\tmargin-bottom: -100rpx;\n}\n\n.input {\n\tflex: 1;\n\theight: 80rpx;\n\tpadding: 0 30rpx;\n\tbackground: #f5f5f5;\n\tborder-radius: 40rpx;\n\tfont-size: 28rpx;\n}\n\n.send-btn {\n\twidth: 160rpx;\n\theight: 80rpx;\n\tmargin-left: 20rpx;\n\tbackground: #1890ff;\n\tcolor: white;\n\tborder-radius: 40rpx;\n\tfont-size: 28rpx;\n}\n</style>","import MiniProgramPage from 'E:/桌面/创新培育/kite-master/pages/agent/agent.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":"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"}