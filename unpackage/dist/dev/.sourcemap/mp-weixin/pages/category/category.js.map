{"version":3,"file":"category.js","sources":["pages/category/category.vue","D:/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY2F0ZWdvcnkvY2F0ZWdvcnkudnVl"],"sourcesContent":["<template>\n\t<PageSkeleton v-if=\"isLoading\" />\n\t<view class=\"viewport\" v-else>\n\t\t<!-- 搜索框 -->\n\t\t<view class=\"search\">\n\t\t\t<uni-easyinput :styles=\"styles\" trim=\"both\" prefixIcon=\"search\" :clearable=\"true\" v-model=\"searchContent\"\n\t\t\t\ttype=\"text\" placeholder=\"搜索术语\" confirmType=\"search\" @iconClick=\"onSearch\" @confirm=\"onSearch\" />\n\t\t</view>\n\t\t<!-- 分类 -->\n\t\t<view class=\"categories\">\n\t\t\t<!-- 左侧：一级分类 -->\n\t\t\t<scroll-view class=\"primary\" scroll-y>\n\t\t\t\t<view v-for=\"(item, index) in categoryList\" :key=\"item._id\" class=\"item\"\n\t\t\t\t\t:class=\"{ active: index === activityIndex }\" @tap=\"onTapChangeCategory(index, item._id)\">\n\t\t\t\t\t<text class=\"name\">\n\t\t\t\t\t\t{{ item.name.length <= 4 ? item.name : item.name.substring(0, 3) + '...' }}\n\t\t\t\t\t</text>\n\t\t\t\t</view>\n\t\t\t</scroll-view>\n\n\n\t\t\t<!-- 内容区域 -->\n\t\t\t<scroll-view class=\"secondary\" scroll-y enable-back-to-top refresher-enabled\n\t\t\t\t@scrolltolower=\"onScrolltolower\" @refresherrefresh=\"onRefresherrefresh\"\n\t\t\t\t:refresher-triggered=\"isLriggered\">\n\t\t\t\t<PreviewList ref=\"PreviewRef\" :name=\"curName\" :id=\"curId\" />\n\t\t\t</scroll-view>\n\n\t\t</view>\n\t</view>\n</template>\n\n<script setup lang=\"ts\">\n\timport { onLoad, onShow } from '@dcloudio/uni-app'\n\timport { computed, ref } from 'vue';\n\timport PreviewList from './components/PreviewList.vue';\n\n\tconst db = uniCloud.database();\n\tconst PreviewRef = ref(null)\n\n\t//触底加载\n\tconst onScrolltolower = () => {\n\t\tPreviewRef.value?.getMore()\n\t}\n\n\t//获取分类\n\tconst categoryList = ref<{ _id : string, name : string, icon ?: string }[]>([])\n\tconst getCategoryData = async () => {\n\t\tconst categoryTable = db.collection('opendb-news-categories')\n\t\tconst res = await categoryTable.field(\"_id,name\").get()\n\t\tcategoryList.value = res.result.data\n\t\tuni.__f__('log','at pages/category/category.vue:52',\"获取分类数据\", categoryList.value)\n\t}\n\n\tconst activityIndex = ref(0)\n\t//当前分类名称和id\n\tconst curName = computed(() => {\n\t\treturn categoryList.value[activityIndex.value]?.name || '名称'\n\t})\n\tconst curId = computed(() => {\n\t\treturn categoryList.value[activityIndex.value]?._id || '0'\n\t})\n\n\t//tab点击事件\n\tconst onTapChangeCategory = (index : number, id : string) => {\n\t\tactivityIndex.value = index\n\t\tuni.setStorage({ key: 'curCategory', data: id })\n\t}\n\n\t//自定义下拉刷新状态\n\tconst isLriggered = ref(false)\n\t// 自定义下拉刷新被触发\n\tconst onRefresherrefresh = async () => {\n\t\t//开始动画\n\t\tisLriggered.value = true\n\t\t//先重置预览列表数据\n\t\tawait PreviewRef.value?.resetData()\n\t\t//结束动画\n\t\tisLriggered.value = false\n\t}\n\n\t//搜索\n\t//搜索内容\n\tconst searchContent = ref('')\n\tconst onSearch = () => {\n\t\tif (searchContent.value === '') {\n\t\t\treturn uni.showToast({\n\t\t\t\ttitle: '请输入搜索内容',\n\t\t\t\ticon: 'none',\n\t\t\t})\n\t\t}\n\t\tuni.navigateTo({\n\t\t\turl: `/pages/search/search?content=${searchContent.value}`,\n\t\t})\n\t}\n\n\t//页面加载中\n\tconst isLoading = ref(true)\n\tconst curCategory = ref('')\n\tonLoad(async () => {\n\t\tcurCategory.value = uni.getStorageSync('curCategory')\n\t\tawait getCategoryData()\n\t\tcategoryList.value = uni.getStorageSync('categoryList')._value\n\t\t// uni.__f__('log','at pages/category/category.vue:104','categoryList',categoryList.value);\n\t\tuni.__f__('log','at pages/category/category.vue:105','定位分类', curCategory.value);\n\t\tif (curCategory.value !== '') {\n\t\t\tconst index = categoryList.value.findIndex((item) => item._id === curCategory.value)\n\t\t\tif (index !== -1) {\n\t\t\t\tactivityIndex.value = index\n\t\t\t}\n\t\t}\n\t\tisLoading.value = false\n\t})\n\n\t//页面显示时读取缓存，设置当前分类\n\tonShow(() => {\n\t\tconst id = uni.getStorageSync('curCategory')\n\t\tif (id) {\n\t\t\tconst index = categoryList.value.findIndex((item) => item._id === id)\n\t\t\tif (index !== -1) {\n\t\t\t\tactivityIndex.value = index\n\t\t\t}\n\t\t}\n\t})\n\n\tconst styles = {\n\t\tcolor: '#333',\n\t\tborderColor: '#111',\n\t\tbackgroundColor: 'rgba(255, 255, 255, 0.5)',\n\t\tdisableColor: '#f7f6f6',\n\t}\n</script>\n\n\n<style lang=\"scss\">\n\tpage {\n\t\theight: 100%;\n\t\toverflow: hidden;\n\t}\n\n\t.viewport {\n\t\theight: 100%;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t}\n\n\t.search {\n\t\tpadding: 0 30rpx 20rpx;\n\t\tbackground-color: #fff;\n\n\t\t.input {\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\tjustify-content: space-between;\n\t\t\theight: 64rpx;\n\t\t\tpadding-left: 26rpx;\n\t\t\tcolor: #8b8b8b;\n\t\t\tfont-size: 28rpx;\n\t\t\tborder-radius: 32rpx;\n\t\t\tbackground-color: #f3f4f4;\n\t\t}\n\t}\n\n\t.icon-search {\n\t\t&::before {\n\t\t\tmargin-right: 10rpx;\n\t\t}\n\t}\n\n\t/* 分类 */\n\t.categories {\n\t\tflex: 1;\n\t\tmin-height: 400rpx;\n\t\tdisplay: flex;\n\t}\n\n\t/* 一级分类 */\n\t.primary {\n\t\toverflow: hidden;\n\t\twidth: 180rpx;\n\t\tflex: none;\n\t\tbackground-color: #f6f6f6;\n\n\t\t.item {\n\t\t\tdisplay: flex;\n\t\t\tjustify-content: center;\n\t\t\talign-items: center;\n\t\t\theight: 96rpx;\n\t\t\tfont-size: 26rpx;\n\t\t\tcolor: #595c63;\n\t\t\tposition: relative;\n\n\t\t\t&::after {\n\t\t\t\tcontent: '';\n\t\t\t\tposition: absolute;\n\t\t\t\tleft: 42rpx;\n\t\t\t\tbottom: 0;\n\t\t\t\twidth: 96rpx;\n\t\t\t\tborder-top: 1rpx solid #e3e4e7;\n\t\t\t}\n\t\t}\n\n\t\t.active {\n\t\t\tbackground-color: #fff;\n\n\t\t\t&::before {\n\t\t\t\tcontent: '';\n\t\t\t\tposition: absolute;\n\t\t\t\tleft: 0;\n\t\t\t\ttop: 0;\n\t\t\t\twidth: 8rpx;\n\t\t\t\theight: 100%;\n\t\t\t\tbackground-color: #27ba9b;\n\t\t\t}\n\t\t}\n\t}\n\n\t.primary .item:last-child::after,\n\t.primary .active::after {\n\t\tdisplay: none;\n\t}\n\n\t/* 二级分类 */\n\t.secondary {\n\t\tbackground-color: #fff;\n\n\t\t.carousel {\n\t\t\theight: 200rpx;\n\t\t\tmargin: 0 30rpx 20rpx;\n\t\t\tborder-radius: 4rpx;\n\t\t\toverflow: hidden;\n\t\t}\n\n\t\t.panel {\n\t\t\tmargin: 0 30rpx 0rpx;\n\t\t}\n\n\t\t.title {\n\t\t\theight: 60rpx;\n\t\t\tline-height: 60rpx;\n\t\t\tcolor: #333;\n\t\t\tfont-size: 28rpx;\n\t\t\tborder-bottom: 1rpx solid #f7f7f8;\n\n\t\t\t.more {\n\t\t\t\tfloat: right;\n\t\t\t\tpadding-left: 20rpx;\n\t\t\t\tfont-size: 24rpx;\n\t\t\t\tcolor: #999;\n\t\t\t}\n\t\t}\n\n\t\t.more {\n\t\t\t&::after {\n\t\t\t\tfont-family: 'iconfont' !important;\n\t\t\t\tcontent: '\\e600';\n\t\t\t}\n\t\t}\n\n\t\t.section {\n\t\t\twidth: 100%;\n\t\t\tdisplay: flex;\n\t\t\tflex-wrap: wrap;\n\t\t\tpadding: 20rpx 0;\n\t\t}\n\t}\n</style>","import MiniProgramPage from 'E:/桌面/创新培育/kite-master/pages/category/category.vue'\nwx.createPage(MiniProgramPage)"],"names":["uniCloud","ref","uni","computed","onLoad","onShow","MiniProgramPage"],"mappings":";;;;;;;;;;;AAmCC,MAAA,cAAwB,MAAA;;;;AAElB,UAAA,KAAKA,iBAAS;AACd,UAAA,aAAaC,kBAAI,IAAI;AAG3B,UAAM,kBAAkB,MAAM;;AAC7B,uBAAW,UAAX,mBAAkB;AAAA,IAAQ;AAIrB,UAAA,eAAeA,kBAAuD,CAAA,CAAE;AAC9E,UAAM,kBAAkB,YAAY;AAC7B,YAAA,gBAAgB,GAAG,WAAW,wBAAwB;AAC5D,YAAM,MAAM,MAAM,cAAc,MAAM,UAAU,EAAE;AACrC,mBAAA,QAAQ,IAAI,OAAO;AAChCC,oBAAA,MAAI,MAAM,OAAM,qCAAoC,UAAU,aAAa,KAAK;AAAA,IAAA;AAG3E,UAAA,gBAAgBD,kBAAI,CAAC;AAErB,UAAA,UAAUE,cAAAA,SAAS,MAAM;;AAC9B,eAAO,kBAAa,MAAM,cAAc,KAAK,MAAtC,mBAAyC,SAAQ;AAAA,IAAA,CACxD;AACK,UAAA,QAAQA,cAAAA,SAAS,MAAM;;AAC5B,eAAO,kBAAa,MAAM,cAAc,KAAK,MAAtC,mBAAyC,QAAO;AAAA,IAAA,CACvD;AAGK,UAAA,sBAAsB,CAAC,OAAgB,OAAgB;AAC5D,oBAAc,QAAQ;AACtBD,oBAAA,MAAI,WAAW,EAAE,KAAK,eAAe,MAAM,IAAI;AAAA,IAAA;AAI1C,UAAA,cAAcD,kBAAI,KAAK;AAE7B,UAAM,qBAAqB,YAAY;;AAEtC,kBAAY,QAAQ;AAEd,cAAA,gBAAW,UAAX,mBAAkB;AAExB,kBAAY,QAAQ;AAAA,IAAA;AAKf,UAAA,gBAAgBA,kBAAI,EAAE;AAC5B,UAAM,WAAW,MAAM;AAClB,UAAA,cAAc,UAAU,IAAI;AAC/B,eAAOC,cAAAA,MAAI,UAAU;AAAA,UACpB,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACN;AAAA,MACF;AACAA,oBAAAA,MAAI,WAAW;AAAA,QACd,KAAK,gCAAgC,cAAc,KAAK;AAAA,MAAA,CACxD;AAAA,IAAA;AAII,UAAA,YAAYD,kBAAI,IAAI;AACpB,UAAA,cAAcA,kBAAI,EAAE;AAC1BG,kBAAAA,OAAO,YAAY;AACN,kBAAA,QAAQF,cAAAA,MAAI,eAAe,aAAa;AACpD,YAAM,gBAAgB;AACtB,mBAAa,QAAQA,cAAA,MAAI,eAAe,cAAc,EAAE;AAExDA,oBAAA,MAAI,MAAM,OAAM,sCAAqC,QAAQ,YAAY,KAAK;AAC1E,UAAA,YAAY,UAAU,IAAI;AACvB,cAAA,QAAQ,aAAa,MAAM,UAAU,CAAC,SAAS,KAAK,QAAQ,YAAY,KAAK;AACnF,YAAI,UAAU,IAAI;AACjB,wBAAc,QAAQ;AAAA,QACvB;AAAA,MACD;AACA,gBAAU,QAAQ;AAAA,IAAA,CAClB;AAGDG,kBAAAA,OAAO,MAAM;AACN,YAAA,KAAKH,cAAAA,MAAI,eAAe,aAAa;AAC3C,UAAI,IAAI;AACD,cAAA,QAAQ,aAAa,MAAM,UAAU,CAAC,SAAS,KAAK,QAAQ,EAAE;AACpE,YAAI,UAAU,IAAI;AACjB,wBAAc,QAAQ;AAAA,QACvB;AAAA,MACD;AAAA,IAAA,CACA;AAED,UAAM,SAAS;AAAA,MACd,OAAO;AAAA,MACP,aAAa;AAAA,MACb,iBAAiB;AAAA,MACjB,cAAc;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChIhB,GAAG,WAAWI,SAAe;"}